<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>RBS School Hub â€” Generator</title>

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #eef2f7;
      margin: 0;
      padding: 20px;
    }
    .container {
      max-width: 650px;
      margin: 30px auto;
      background: #fff;
      padding: 25px;
      border-radius: 14px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.07);
    }
    h2 { text-align: center; margin-bottom: 5px; }
    p.sub { text-align:center; color:#666; margin-bottom:25px; }

    button {
      width: 100%;
      padding: 15px;
      margin-top: 12px;
      border: none;
      border-radius: 10px;
      background: #007bff;
      color: white;
      font-size: 16px;
      cursor: pointer;
      transition: .15s;
      font-weight: bold;
    }
    button.secondary { background: #28a745; }
    button.danger { background: #ff5722; }

    button:hover {
      opacity: .9;
    }
    button:active { transform: translateY(1px); }

    #msg {
      margin-top: 18px;
      padding: 12px;
      border-radius: 8px;
      display:none;
      font-weight: bold;
    }
    #msg.success { background:#e6ffed; color:#007a3d; display:block; }
    #msg.error { background:#ffe6e6; color:#b30000; display:block; }
  </style>
</head>
<body>
  <div class="container">
    <h2>RBS School Hub â€” Generator</h2>
    <p class="sub">Klik tombol untuk membuat seluruh koleksi Firestore secara otomatis.</p>

    <button id="btn-generate-web">Generate WEB Collections Lengkap</button>
    <button id="btn-generate-chat" class="secondary">Generate Chat Rooms (Public + Private + Ghibah)</button>
    <button id="btn-generate-admin" class="danger">Generate Admin Config</button>

    <div id="msg"></div>
  </div>

  <!-- ================= FIREBASE SCRIPT ================= -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    // ---------- CONFIG ----------
    const firebaseConfig = {
      apiKey: "AIzaSyAsaVfy4SOegY1HxUZTJoR2HETUenU8CUo",
      authDomain: "rbs-schoolhub.firebaseapp.com",
      projectId: "rbs-schoolhub",
      storageBucket: "rbs-schoolhub.firebasestorage.app",
      messagingSenderId: "625460145450",
      appId: "1:625460145450:web:c75a85e57b37c00bd94253",
      measurementId: "G-ZZTN0NNGZV"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // ---------- UI helpers ----------
    const msgEl = document.getElementById('msg');
    function showSuccess(text) {
      msgEl.className = 'success';
      msgEl.textContent = text;
      msgEl.style.display = 'block';
    }
    function showError(text) {
      msgEl.className = 'error';
      msgEl.textContent = text;
      msgEl.style.display = 'block';
    }

    // ============================================================
    // 1. GENERATE WEB COLLECTIONS
    // ============================================================
    async function generateWebCollections() {
      try {
        // homepage config
        const confRef = doc(db, "config", "homepage");
        if (!(await getDoc(confRef)).exists()) {
          await setDoc(confRef, {
            schoolName: "RBS School Hub",
            headerImage: "",
            themeColor: "#007bff",
            description: "Sistem informasi sekolah RBS",
            createdAt: Date.now(),
            lastUpdate: Date.now()
          });
        }

        // default layout sections
        const sections = ["upcomingEvents", "extracurricular", "trending", "comingSoon"];
        for (const s of sections) {
          const ref = doc(db, "homepageSections", s);
          if (!(await getDoc(ref)).exists()) {
            await setDoc(ref, { enabled: true, items: [] });
          }
        }

        // sample data
        await setDoc(doc(db, "homepageSections", "extracurricular-sample"), {
          enabled: true,
          items: [
            { title: "Basket", desc: "Latihan Sabtu", image: "" },
            { title: "Volly", desc: "Tim aktif", image: "" },
            { title: "Pramuka", desc: "Outdoor survival", image: "" }
          ]
        });

        await setDoc(doc(db, "homepageSections", "upcomingEvents-sample"), {
          enabled: true,
          items: [
            { date: "2025-11-28", title: "Ujian Tengah Semester", desc: "1 minggu" },
            { date: "2025-12-15", title: "Class Meeting", desc: "Turnamen sekolah" }
          ]
        });

        await setDoc(doc(db, "homepageSections", "trending-sample"), {
          enabled: true,
          items: [
            { title: "Juara FLS2N", desc: "Menang lomba musik" },
            { title: "Project Website", desc: "Situs baru siswa RBS" }
          ]
        });

        await setDoc(doc(db, "homepageSections", "comingSoon-sample"), {
          enabled: true,
          items: [
            { title: "Perpustakaan Digital", desc: "Rilis Jan 2026" }
          ]
        });

        showSuccess("WEB Collections + sample berhasil dibuat!");
      } catch (err) {
        console.error(err);
        showError("Gagal generate Web Collections.");
      }
    }

    // ============================================================
    // 2. GENERATE CHAT ROOMS (PUBLIC, PRIVATE, GHIBAH)
    // ============================================================
    async function generateChatRooms() {
      try {
        // Public room
        const pub = doc(db, "chatRooms", "public");
        if (!(await getDoc(pub)).exists()) {
          await setDoc(pub, {
            name: "Public Lobby ðŸ’¬",
            passwordEnabled: false,
            allowAnonymous: true,
            createdAt: Date.now()
          });
        }

        // Private room + password
        const priv = doc(db, "chatRooms", "privateRoom");
        if (!(await getDoc(priv)).exists()) {
          await setDoc(priv, {
            name: "Private Room ðŸ”’",
            passwordEnabled: true,
            password: "12345",
            allowAnonymous: false,
            createdAt: Date.now()
          });
        }

        // GHIBAH room
        const ghibah = doc(db, "chatRooms", "ghibah");
        if (!(await getDoc(ghibah)).exists()) {
          await setDoc(ghibah, {
            name: "Ghibah Room ðŸ”¥",
            passwordEnabled: false,
            allowAnonymous: true,
            createdAt: Date.now()
          });
        }

        showSuccess("Semua Chat Rooms berhasil dibuat!");
      } catch (err) {
        console.error(err);
        showError("Gagal generate Chat Rooms.");
      }
    }

    // ============================================================
    // 3. GENERATE ADMIN CONFIG
    // ============================================================
    async function generateAdminConfig() {
      try {
        const adminRef = doc(db, "config", "admin");

        if (!(await getDoc(adminRef)).exists()) {
          await setDoc(adminRef, {
            enabled: true,
            adminKey: "RBS-2025-SECRET-KEY",
            maintenanceMode: false,
            createdAt: Date.now()
          });
        }

        showSuccess("Admin config berhasil dibuat!");
      } 
      catch (err) {
        console.error(err);
        showError("Gagal membuat admin config.");
      }
    }

    // ============================================================
    // LISTENER BUTTON
    // ============================================================
    document.getElementById('btn-generate-web').addEventListener('click', generateWebCollections);
    document.getElementById('btn-generate-chat').addEventListener('click', generateChatRooms);
    document.getElementById('btn-generate-admin').addEventListener('click', generateAdminConfig);

  </script>
</body>
</html>
